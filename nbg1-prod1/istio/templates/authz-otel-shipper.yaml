# Authorization policy for otel-shipper
# Allows otel-receiver (hostNetwork, not in mesh) to push logs
#
# NOTE: Using ipBlocks (not remoteIpBlocks) because ztunnel only supports L4
# attributes. remoteIpBlocks requires HTTP header parsing (X-Forwarded-For).
apiVersion: security.istio.io/v1
kind: AuthorizationPolicy
metadata:
  name: otel-shipper
  namespace: otel-shipper
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: opentelemetry-collector
  action: ALLOW
  rules:
    # Allow otel-receiver to push logs (from node IPs, not in mesh)
    - from:
        - source:
            ipBlocks: ["10.0.0.0/24"]
